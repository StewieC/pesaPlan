{% extends 'finance/base.html' %}
{% block content %}
    <h2>Dashboard</h2>
    <p>Welcome, {{ user.username }}!</p>

    {% if latest_budget %}
        <div class="card">
            <h3>Current Budget Summary ({{ latest_budget.month|date:"F Y" }})</h3>
            <p><strong>Total Budget:</strong> {{ latest_budget.total_amount }} KSH</p>
            <p><strong>Allocated:</strong> {{ total_allocated }} KSH</p>
            <p><strong>Savings:</strong> {{ savings }} KSH</p>
            {% if savings < 0 %}
                <div class="message error">Over Budget by {{ over_budget_amount }} KSH!</div>
            {% endif %}
        </div>
    {% else %}
        <div class="card">
            <p>No budgets yet. <a href="{% url 'finance:budget_create' %}">Create your first budget now!</a></p>
        </div>
    {% endif %}

    {% if budgets %}
        <div class="card">
            <h3>Your Budgets</h3>
            <table>
                <thead>
                    <tr>
                        <th>Month</th>
                        <th>Total Amount (KSH)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for budget in budgets %}
                        <tr>
                            <td>{{ budget.month|date:"F Y" }}</td>
                            <td>{{ budget.total_amount }}</td>
                            <td>
                                <a href="{% url 'finance:budget_detail' budget.pk %}" class="btn btn-secondary">View</a>
                                <a href="{% url 'finance:allocation_create' budget.pk %}" class="btn">Add Allocation</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
{% endblock %}